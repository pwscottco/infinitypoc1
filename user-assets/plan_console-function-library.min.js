var ct = (function() {
      
    /* inject:functions */
    
   var authenticate =  function (username, password, successCallback) {
       debugger;
       ct.initialiseFirebaseApp();
       
       firebase.auth().signInWithEmailAndPassword(username, password).catch(function(error) {
           // Handle Errors here.
           //var errorCode = error.code;
           var errorMessage = error.message;
           alert('Error: ' + errorMessage);
       });
         
       firebase.auth().onAuthStateChanged(function(user) {
           if (user) {
   
               cti.store.variables.user = JSON.parse(JSON.stringify(user));
               
               firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                   delete cti.store.pages.Login.password;
                   cti.store.variables.idToken = idToken;
                   successCallback();
               }).catch(function(error) {
                   alert('Error getting id token: ' + error);
               });
           }
       });
   };
    const clearData = function() {
       delete cti.store.variables.idToken;
       if (cti.store.api.api_azure) {
           cti.store.api.api_azure.messages = [];
           cti.store.api.api_azure.search = [];
           cti.store.api.api_azure.messagestatus = [];
       }
       delete cti.store.pages.Home;
       delete cti.store.pages.Search;
   };
    var guid = function() {
       return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
           var r = crypto.getRandomValues(new Uint8Array(1))[0]%16|0, v = c == 'x' ? r : (r&0x3|0x8);
           return v.toString(16);
       });
   };
    var initData = function () {
       cti.store.variables.flag_reasons = [{
           'r': 'Requests for financial support'
       },
       {
           'r': 'Exploitation'
       },
       {
           'r': 'Offers of or requests for assistance'
       },
       {
           'r': 'Requests for support with resettlement'
       },
       {
           'r': 'Bullying or harassment'
       },
       {
           'r': 'Direct threats'
       },
       {
           'r': 'Inappropriate subject matter'
       },
       {
           'r': 'Sexual violence and exploitation'
       },
       {
           'r': 'Invitation to come to country / home of donor'
       },
       {
           'r': 'Invitation to meet in real life'
       },
       {
           'r': 'Invitation to communicate outside of the App'
       },
       {
           'r': 'Sharing or asking for details for direct contact'
       },
       {
           'r': 'Violent / Graphic content / language'
       },
       {
           'r': 'Hate speech'
       },
       {
           'r': 'Romance / romantic gestures'
       },
       {
           'r': 'Nudity / Sexual Activity'
       },
       {
           'r': 'Offensive language (content)'
       },
       {
           'r': 'Inflammatory content  - religion / politics'
       },
       {
           'r': 'Photos and images which are inappropriate'
       },
       {
           'r': 'Promoting or publicizing crime'
       },
       {
           'r': 'Sharing internet links'
       },
       {
           'r': 'Poor content'
       },
       {
           'r': 'Complaints or questions for UNHCR'
       }
     ];
   
       cti.store.variables.locations = [{
           'l': 'ALMAS SOZINHAS - TIMBIRAS'
       },
       {
           'l': 'ANJO DA GUARDA - TIMBIRAS'
       },
       {
           'l': 'AXIXÁ - CODÓ'
       },
       {
           'l': 'BACABINHA -CODÓ'
       },
       {
           'l': 'BARRO VERMELHO - CODÓ'
       },
       {
           'l': 'BOQUEIRÃO DOS VIEIRAS- CODÓ'
       },
       {
           'l': 'CAJAZEIRAS - CODÓ'
       },
       {
           'l': 'CANTO DO COXO - CODÓ'
       },
       {
           'l': 'CENTRO DO EXPEDITO - CODÓ'
       },
       {
           'l': 'CODÓ - NOVO - CODÓ'
       },
       {
           'l': 'EIRA DOS COQUEIROS - CODÓ'
       },
       {
           'l': 'FILIPINHO - PERITORÓ'
       },
       {
           'l': 'FORQUILHA – TIMBIRAS'
       },
       {
           'l': 'HORTA - TIMBIRAS'
       },
       {
           'l': 'INDEPENDENCIA – PERITORÓ'
       },
       {
           'l': 'JATOBA'
       },
       {
           'l': 'LIVRAMENTO - PERITORÓ'
       },
       {
           'l': 'MARAJÁ DO VELOSO - CODÓ'
       },
       {
           'l': 'MATA VIRGEM - CODÓ'
       },
       {
           'l': 'MATÕES DA RITA - CODÓ'
       },
       {
           'l': 'MIRINDIBA - CODÓ'
       },
       {
           'l': 'MONTE CRISTO - CODÓ'
       },
       {
           'l': 'MONTEVIDEU - CODÓ'
       },
       {
           'l': 'MUTIRÃO - TIMBIRAS'
       },
       {
           'l': 'NOSSA SENHORA DE FATIMA - CODÓ'
       },
       {
           'l': 'NOVA JERUSALÉM - CODÓ'
       },
       {
           'l': 'OLARIA - TIMBIRAS'
       },
       {
           'l': 'RAPOSA DO ZECA FARIAS'
       },
       {
           'l': 'RESIDENCIAL SANTA RITA - CODÓ'
       },
       {
           'l': 'RIACHO SECO - CODÓ'
       },
       {
           'l': 'ROCINHA II - PERITORÓ'
       },
       {
           'l': 'SANTARÉM - TIMBIRAS'
       },
       {
           'l': 'SANTO ANTONIO - CODÓ'
       },
       {
           'l': 'SANTO ANTONIO DOS PRETOS - CODÓ'
       },
       {
           'l': 'SÃO BENEDITO DOS COLOCADOS - CODÓ'
       },
       {
           'l': 'SÃO FRANCISCO  - CODÓ'
       },
       {
           'l': 'SÃO PEDRO - CODÓ'
       },
       {
           'l': 'SÃO RAIMUNDO - CODÓ'
       },
       {
           'l': 'SÃO RAIMUNDO - TIMBIRAS'
       },
       {
           'l': 'SÃO SEBASTIÃO - CODÓ'
       },
       {
           'l': 'SÃO SEBASTIÃO - TIMBIRAS'
       },
       {
           'l': 'SARDINHA - TIMBIRAS'
       },
       {
           'l': 'VAI QUEM QUER - CODÓ'
       }
       ];
   };
    var initialiseFirebaseApp =  function () {
       if (firebase.apps.length == 0) {
           var config = {
               apiKey: cti.store.schema.metadata.FIREBASE_APIKEY.value,
               authDomain: 'plan-international-61702.firebaseapp.com'
           };
           firebase.initializeApp(config);
       }
   };
    const loadingButton = function (button, loading) {
       const btn = $(button);
       if (btn.length > 0) {
           const html = btn.html();
           const icon = '<i class="fa fa-spinner fa-spin"></i> ';
           if (loading) {
               if (!html.includes(icon)) {
                   btn.html(icon + html);
               }
           } else {
               btn.html(html.replace(icon, ''));
           }
       }
   };
    var logout =  function (successCallback) {
       ct.initialiseFirebaseApp();
     
       firebase.auth().signOut().then(function() {
           ct.clearData();
           successCallback();
       }).catch(function(error) {
           alert('Log out error' + error);
       });
   };
    var refreshToken = function (successCallback) {
       ct.initialiseFirebaseApp();
       
       if (firebase.auth().currentUser) {
           firebase.auth().currentUser.getIdToken(/* forceRefresh */ false).then(function (idToken) {
               cti.store.variables.idToken = idToken;
               successCallback();
           }).catch(function (error) {
               alert('Error getting id token: ' + error);
           });
       }
   };
    /* end:inject:functions */
       
         return {
   
           /* inject:returns */
           authenticate:authenticate,clearData:clearData,guid:guid,initData:initData,initialiseFirebaseApp:initialiseFirebaseApp,loadingButton:loadingButton,logout:logout,refreshToken:refreshToken
           /* end:inject:returns */  
                
         };
       })();
       